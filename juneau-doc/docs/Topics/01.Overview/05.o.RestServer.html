<!--
/***************************************************************************************************************************
 * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *  
 *  http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations under the License.
 ***************************************************************************************************************************/
 -->

{title:'REST Server Overview'} 

<h5 class='topic'>@Rest-Annotated Resources</h5>
<div class='topic'>
	<p>
		A REST resource is simply a Java class annotated with {@link oajr.annotation.Rest}.
		The most common case is a class that extends {@link oajr.servlet.BasicRestServlet}, which itself is simply an 
		extension of {@link javax.servlet.http.HttpServlet} which allows it to be deployed as a servlet.  
	</p>
	<p class='bjava'>
		|	<jc>// Sample REST resource that prints out a simple "Hello world!" message.</jc>
		|	<ja>@Rest</ja>(
		|		path=<js>"/helloWorld"</js>,
		|		title=<js>"Hello World"</js>,
		|		description=<js>"An example of the simplest-possible resource"</js>
		|	)
		|	<ja>@HtmlDoc</ja>(
		|		navlinks={
		|			<js>"up: request:/.."</js>,
		|			<js>"options: servlet:/?method=OPTIONS"</js>
		|		},
		|		aside={
		|			<js>"&lt;div style='max-width:400px' class='text'&gt;"</js>,
		|			<js>"	&lt;p&gt;This page shows a resource that simply response with a 'Hello world!' message&lt;/p&gt;"</js>,
		|			<js>"	&lt;p&gt;The POJO serialized is a simple String.&lt;/p&gt;"</js>,
		|			<js>"&lt;/div&gt;"</js>
		|		}
		|	)
		|	<ja>@BeanConfig</ja>(sortProperties=<js>"true"</js>)
		|	<jk>public class</jk> HelloWorldResource <jk>extends</jk> BasicRestServlet <jk>implements</jk> BasicUniveralConfig {
		|	
		|		<ja>@RestGet</ja>(path=<js>"/*"</js>, summary=<js>"Responds with \"Hello world!\""</js>)
		|		<jk>public</jk> String sayHello() {
		|			<jk>return</jk> <js>"Hello world!"</js>;
		|		}
		|	}
	</p>
	<p>
		This is what it looks like in a browser.
	</p>
	<p class='bcode'>
		|	http://localhost:10000/helloWorld
	</p>
	<img class='bordered w800' src='doc-files/jrs.HelloWorldExample.1.png'>
	<ul>
		<li>Parsers for request bodies are selected based on the request <c>Content-Type</c> header.
		<li>Serializers for response bodies are selected based on the request <c>Accept</c> header.
		<ul>
			<li>In this case, it's the {@link oaj.html.HtmlDocSerializer} serializer based on the
				browser's default <c>Accept</c> header that's asking for HTML.
		</ul>
		<li>REST resource classes and methods can be annotated with configuration annotations for the serializers and parsers (such as <ja>@HtmlConfig</ja> and <ja>@BeanConfig</ja> shown above).
		<li>Annotations such as the title, summary, and descriptions shown above are used for auto-generated Swagger UI pages (described later).
	</ul>
</div>

<h5 class='topic'>REST Children</h5>
<div class='topic'>
	<p>
		Child Resources are REST servlets or objects that are linked to parent resources through the 
		{@link oajr.annotation.Rest#children() @Rest(children)} annotation.
	</p>
	<h5 class='figure'>Example:</h5>
	<p class='bjava'>
		|	<jd>/** Parent Resource */</jd>
		|	<ja>@Rest</ja>(
		|		path=<js>"/parent"</js>,
		|		children={
		|			MyChildResource.<jk>class</jk>
		|		}
		|	)
		|	<jk>public</jk> MyParentResource <jk>extends</jk> BasicRestServlet <jk>implements</jk> BasicUniversalConfig {...}
	</p>
	<p class='bjava'>
		|	<jd>/** Child Resource */</jd>
		| 	<ja>@Rest</ja>(
		|		path=<js>"/child"</js>  <jc>// Path relative to parent resource.</jc>
		|	)
		|	<jk>public</jk> MyChildResource {...} <jc>// Note that we don't need to extend from RestServlet.</jc>
	</p>
	<p>
		The path of the child resource gets appended to the path of the parent resource. 
		So in the example above, the child resource is accessed through the URL <l>/parent/child</l>.
	</p>
	<p>
		A HUGE advantage of using child resources is that they do not need to be declared in the JEE <l>web.xml</l> 
		file.
		Initialization of and access to the child resources occurs through the parent resource.
		Children can be nested arbitrary deep to create complex REST interfaces with a single top-level REST servlet.
	</p>
</div>

<h5 class='topic'>REST Group Pages</h5>
<div class='topic'>
	<p>
		The {@link oajr.servlet.BasicRestServletGroup} class provides a default "router" page for 
		child resources when a parent resource is nothing more than a grouping of child resources.
	</p>		
	<p>
		The <l>RootResources</l> class in the Samples project is an example of a router page:
	</p>
	<p class='bjava'>		
		|	<jd>/**
		|	 * Sample REST resource showing how to implement a "router" resource page.
		|	 */</jd>
		|	<ja>@Rest</ja>(
		|		path=<js>"/"</js>,
		|		title=<js>"Root resources"</js>,
		|		description=<js>"Example of a router resource page."</js>,
		|		children={
		|			HelloWorldResource.<jk>class</jk>,
		|			PetStoreResource.<jk>class</jk>,
		|			DtoExamples.<jk>class</jk>,
		|			ConfigResource.<jk>class</jk>,
		|			LogsResource.<jk>class</jk>,
		|			ShutdownResource.<jk>class</jk>
		|		}
		|	)
		|	<jk>public class</jk> RootResources <jk>extends</jk> BasicRestServletGroup <jk>implements</jk> BasicUniversalConfig {
		|		<jc>// NO CODE!!!</jc>
		|	}
	</p>
	<p>
		When you bring up this resource in a browser, you see the following that provides a list
		of navigable links to your child resources:
	</p>
	<p class='bcode'>
		|	http://localhost:10000
	</p>
	<img class='bordered w800' src='doc-files/jrs.RouterPages.1.png'/>
</div>

<h5 class='topic'>REST Resource Methods</h5>
<div class='topic'>
	<p>
		The real power behind the REST server API is the ability to define Java methods as REST endpoints.
	</p>
	<h5 class='figure'>Example:</h5>
	<p class='bjava'>
		|	<ja>@RestPost</ja>(path=<js>"/pets"</js>, guards=AdminGuard.<jk>class</jk>)
		|	<jk>public</jk> Ok addPet(
		|		<ja>@Content</ja> CreatePet <jv>createPetBean</jv>, 
		|		<ja>@Header</ja>(<js>"E-Tag"</js>) UUID <jv>etag</jv>, 
		|		<ja>@Query</ja>(<js>"debug"</js>) <jk>boolean</jk> <jv>debug</jv>
		|	) <jk>throws</jk> BadRequest, Unauthorized, InternalServerError {
		|		<jc>// Process request.</jc>
		|		<jk>return</jk> Ok.<jsf>OK</jsf>;
		|	}
	</p>
	<p>
		Java methods on {@link oajr.annotation.Rest @Rest}-annotated classes have the following format:
	</p>
	<p class='bjava'>
		|	<ja>@RestOp</ja>(method=<js>"..."</js>, path=<js>"..."</js>)
		|	<ja><i>&lt;config-annotations&gt;</i></ja>
		|	<jk>public</jk> <i>&lt;return-type&gt;</i> method(<i>&lt;args&gt;</i>) <jk>throws</jk> <i>&lt;throwables&gt;</i> {
		|		...
		|	}
	</p>
	<p>
		The various parts require their own topics to fully appreciate the scope of abilities, but the following is a summary:
	</p>
	<ul class='spaced-list'>
		<li>Annotated with {@link oajr.annotation.RestOp @RestOp}.
		<ul>
			<li>Also available: {@link oajr.annotation.RestGet @RestGet} / {@link oajr.annotation.RestPut @RestPut} / {@link oajr.annotation.RestPost @RestPost} / {@link oajr.annotation.RestDelete @RestDelete}.
			<li>Annotation optional if using standard naming conventions (e.g. <c>getFoo()</c> equivalent to <c><ja>@RestGet</ja>(path=<js>"/foo"</js>)</c>).
		</ul>
		<li>Optionally annotated with config annotations such as {@link oaj.annotation.BeanConfig @BeanConfig} and {@link oaj.html.annotation.HtmlDocConfig @HtmlDocConfig} that 
			customize the behavior of serializers and parsers at the method level.
		<li>Returned object gets serialized as the HTTP response body.
		<ul>
			<li>Typically a POJO serialized based on {@link oaj.http.header.Accept} request header.
			<li>Support for raw values such as <c>Readers</c> and <c>InputStreams</c> (among others).
			<li>Support for response beans annotated with {@link oaj.http.annotation.Response @Response}.
			<li>Support for Apache Http Core interfaces: {@link org.apache.http.HttpEntity} / {@link org.apache.http.HttpResponse} / {@link oaj.http.resource.HttpResource}.
			<li>Standard HTTP responses such as {@link oaj.http.response.Ok} and {@link oaj.http.response.TemporaryRedirect} provided in {@link oaj.http.response} package.
			<li>Extensible API for defining custom return types.
		</ul>
		<li>A wide range of possible argument types including:
		<ul>
			<li>Standard {@link javax.servlet.http.HttpServletRequest} / {@link javax.servlet.http.HttpServletResponse} objects.
			<li>Extended {@link oajr.RestRequest} / {@link oajr.RestResponse} objects.
			<li>Parsed HTTP parts with either the arguments or beans annotated with {@link oaj.http.annotation.Path @Path} / {@link oaj.http.annotation.Header @Header} / {@link oaj.http.annotation.Query @Query} / {@link oaj.http.annotation.FormData @FormData}.
			<li>Parsed HTTP body with either the argument or bean annotated with {@link oaj.http.annotation.Content @Content}.
			<li>Raw HTTP request body with <c>InputStream</c> or <c>Reader</c>.
			<li>Raw HTTP response body with <c>OutputStream</c> or <c>Writer</c>.
			<li>Request beans annotated with {@link oaj.http.annotation.Request @Request}.
			<li>Response beans annotated with {@link oaj.http.annotation.Response @Response}.
			<li>Standard HTTP headers such as {@link oaj.http.header.Accept} and {@link oaj.http.header.ContentType}  provided in {@link oaj.http.header} package.
			<li>Auto-generated {@link oaj.dto.swagger.Swagger}.
			<li>Various other standard objects such as {@link java.security.Principal}, {@link javax.servlet.http.Cookie}, {@link javax.servlet.http.HttpSession}, and {@link java.util.ResourceBundle}.
			<li>Spring beans or other injectable beans.
			<li>Extensible API for defining custom argument types.
		</ul>
		<li>Throwables can be anything.
		<ul>
			<li>Typically one of the standard HTTP responses such as {@link oaj.http.response.BadRequest} or {@link oaj.http.response.NotFound} provided in {@link oaj.http.response} package.
			<li>Can define your own {@link oaj.http.annotation.Response @Response}-annotated throwables.
			<li>Anything else gets converted to an {@link oaj.http.response.InternalServerError}. 
		</ul>
	</ul>
</div>
	
<h5 class='topic'>Deploying as a Servlet</h5>
<div class='topic'>
	<p>
		The {@link oajr.servlet.BasicRestServlet} class is the entry point for your REST resources.
		It extends directly from <l>HttpServlet</l> and is deployed like any other servlet (such as a standard <c>web.xml</c> file).
	</p>
	<p>
		When the servlet <l>init()</l> method is called, it triggers the code to find and process the <l>@Rest</l>
		annotations on that class and all child classes.
		These get constructed into a {@link oajr.RestContext} object that holds all the configuration
		information about your resource in a read-only object.
	</p>
	<p>
		Most developers are not going to be using the <l>RestServlet</l> class itself, and instead will
		extend from one of the preconfigured default servlets such as {@link oajr.servlet.BasicRestServlet} and {@link oajr.servlet.BasicRestServletGroup} 
		which provides universal language support, basic instrumentation, and auto-generated Swagger UI.
	</p>
</div>

<h5 class='topic'>Deploying in Spring Boot</h5>
<div class='topic'>
	<p>
		The {@link oajr.springboot.BasicSpringRestServlet} class is typically entry point for your REST resources
		when working within a Spring Boot environment.
	</p>
	<p>
		The <c>SpringRestServlet</c> class provides additional capabilities including:
	</p>
	<ul>
		<li>Your REST resources can be defined as injectable Spring beans.
		<li>Various capabilities within the REST Server library (e.g. logging, instrumentation, call handling, API extensions) can be defined via
			Spring beans and automatically pulled into the framework.
	</ul>
	<p>
		Most developers are not going to be using the <l>RestServlet</l> class itself, and instead will
		extend from one of the preconfigured default servlets such as {@link oajr.springboot.BasicSpringRestServlet} and {@link oajr.springboot.BasicSpringRestServletGroup}
		that have the same capabilites as the {@link oajr.servlet.BasicRestServlet} and {@link oajr.servlet.BasicRestServletGroup} counterparts.
	</p>
	<h5 class='figure'>Example configuration file:</h5>
	<p class='bjava'>
		|	<ja>@Configuration</ja>
		|	<jk>public class</jk> MySpringConfiguration {
		|		
		|		<jd>/**
		|		 * Our root REST bean.
		|		 * Note that this must extend from SpringRestServlet so that child resources can be 
		|		 * resolved as Spring beans.
		|		 * All REST objects are attached to this bean using the {@link oajr.annotation.Rest#children()} annotation.
		|		 */</jd>
		|		<ja>@Bean</ja>
		|		<jk>public</jk> RootResources getRootResources() {
		|			<jk>return new</jk> RootResources();
		|		}
		|	
		|		<jd>/**
		|		 * Optionally return the HelloWorldResource object as an injectable bean.
		|		 */</jd>
		|		<ja>@Bean</ja>
		|		<jk>public</jk> HelloWorldResource getHelloWorldResource() {
		|			<jk>return new</jk> HelloWorldResource();
		|		}
		|	
		|		<jd>/**
		|		 * Map our servlet to a path.
		|		 */</jd>
		|		<ja>@Bean</ja>
		|		<jk>public</jk> ServletRegistrationBean&lt;Servlet&gt; getRootServlet(RootResources <jv>rootResources</jv>) {
		|			<jk>return new</jk> ServletRegistrationBean<>(<jv>rootResources</jv>, <js>"/*"</js>);
		|		}
		|	}
	</p>
	<p class='bjava'>
		|	<ja>@Rest</ja>(
		|		children={
		|			HelloWorldResource.<jk>class</jk>
		|		}
		|	)
		|	<jk>public class</jk> RootResources <jk>extends</jk> BasicSpringRestServletGroup <jk>implements</jk> BasicUniversalConfig {
		|		<jc>// No code!</jc>
		|	}
	</p>
</div>

<h5 class='topic'>Additional Information</h5>
<div class='topic'>
	<ul class='seealso'>
		<li class='link'>{@doc juneau-rest-server} for more information.
	</ul>
</div>
